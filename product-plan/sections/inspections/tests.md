# Test Instructions: Inspections

These test-writing instructions are **framework-agnostic**.

## Overview
Test inspection scheduling, results recording, defect tracking, rework workflow, photo management, report generation, and agent roster management.

## User Flow Tests

### Flow 1: View Inspections List
**Scenario:** User views all inspections

#### Success Path
**Setup:** Inspections exist in various statuses

**Steps:**
1. Navigate to Inspections section
2. Verify "Inspections" tab is active
3. Observe inspection table and summary stats

**Expected Results:**
- [ ] Summary shows: Total, Scheduled, Passed, Failed, Pending Rework, Avg Defect Rate
- [ ] Table columns: Batch, Product, Date, Agent, Status, Defect Rate, Actions
- [ ] Status badges: Scheduled, In Progress, Passed, Failed, Pending Rework, Re-inspection
- [ ] Rows sortable by date

### Flow 2: Schedule Inspection
**Scenario:** User schedules new inspection for a PO

#### Success Path
**Setup:** Confirmed PO exists, agents available

**Steps:**
1. Click "Schedule Inspection" button
2. Form opens
3. Select PO from dropdown
4. Set inspection date
5. Select agent from active agents list
6. Choose inspection type: "Pre-shipment"
7. Add notes
8. Submit

**Expected Results:**
- [ ] PO dropdown shows confirmed POs only
- [ ] Agent dropdown shows active agents
- [ ] Date picker prevents past dates
- [ ] Inspection created with "scheduled" status
- [ ] Appears in inspections table

### Flow 3: Record Inspection Results
**Scenario:** User records QC results

#### Success Path
**Setup:** Scheduled inspection exists

**Steps:**
1. Find scheduled inspection
2. Click "Start Inspection" or open detail
3. For each line item:
   - Enter sample size: 200
   - Enter defects found: 5
   - Select defect types found
   - Add defect details
4. Complete measurement checks
5. Record packaging condition
6. Upload photos
7. Set overall result: "Pass"
8. Complete inspection

**Expected Results:**
- [ ] Each PO line item has its own result section
- [ ] Defect rate auto-calculates (5/200 = 2.5%)
- [ ] Defect checklist with types: cosmetic, functional, dimensional, packaging, labeling
- [ ] Measurement checks show spec vs actual
- [ ] Status changes to "passed" or "failed"
- [ ] completedDate set

### Flow 4: Upload Inspection Photos
**Scenario:** User adds photos to inspection

#### Success Path
**Setup:** Inspection in progress

**Steps:**
1. In inspection detail, find Photos section
2. Click "Add Photos"
3. Upload multiple images
4. For each photo:
   - Select type: Defect / Product / Packaging
   - Add caption
5. Save

**Expected Results:**
- [ ] Multiple file upload supported
- [ ] Photos grouped by type in gallery
- [ ] Captions display under photos
- [ ] Photos link to defects if applicable
- [ ] Thumbnails preview before save

### Flow 5: Create Rework Request
**Scenario:** Inspection fails, user requests rework

#### Success Path
**Setup:** Inspection with "failed" status

**Steps:**
1. Open failed inspection
2. Click "Create Rework Request"
3. Form opens
4. Enter instructions: "Replace damaged labels, re-seal packaging"
5. Submit

**Expected Results:**
- [ ] Rework request created with "pending" status
- [ ] Inspection status changes to "pending-rework"
- [ ] Supplier can view and respond to request
- [ ] Re-inspection can be scheduled after rework

### Flow 6: Schedule Re-inspection
**Scenario:** Rework complete, user schedules follow-up

#### Success Path
**Setup:** Inspection with completed rework

**Steps:**
1. Open inspection with completed rework
2. Click "Schedule Re-inspection"
3. Set new date
4. Confirm same or different agent
5. Submit

**Expected Results:**
- [ ] New inspection created linked to original
- [ ] Status: "re-inspection"
- [ ] Original inspection reference preserved
- [ ] Same PO and line items

### Flow 7: Generate Inspection Report
**Scenario:** User creates PDF report

#### Success Path
**Setup:** Completed inspection with results

**Steps:**
1. Open inspection detail
2. Click "Generate Report"
3. PDF downloads

**Expected Results:**
- [ ] PDF includes all inspection data
- [ ] Photos embedded in report
- [ ] Defect summary table
- [ ] Document saved to history with timestamp
- [ ] "generated by" recorded

### Flow 8: Manage Inspection Agents
**Scenario:** User adds new inspection agent

#### Success Path
**Setup:** Agents tab accessible

**Steps:**
1. Click "Agents" tab
2. Click "Add Agent"
3. Form opens
4. Enter name: "John Inspector"
5. Enter email: "john@qima.com"
6. Enter company: "QIMA"
7. Enter location: "Shenzhen"
8. Enter hourly rate: 45
9. Select specialties: "Electronics", "Packaging"
10. Submit

**Expected Results:**
- [ ] Agent created and appears in table
- [ ] Status defaults to "Active"
- [ ] Specialties display as badges
- [ ] Agent available for scheduling

### Flow 9: Toggle Agent Status
**Scenario:** User deactivates an agent

#### Success Path
**Setup:** Active agent exists

**Steps:**
1. In Agents tab, find active agent
2. Click status toggle button
3. Confirm deactivation

**Expected Results:**
- [ ] Status changes to "Inactive"
- [ ] Agent hidden from scheduling dropdowns
- [ ] Agent still visible in Agents list
- [ ] Can be reactivated

## Empty State Tests

### No Inspections
**Setup:** No inspections in system

**Steps:**
1. Navigate to Inspections

**Expected Results:**
- [ ] Empty state illustration
- [ ] "No inspections yet" message
- [ ] "Schedule Inspection" CTA
- [ ] Summary stats show zeros

### No Agents
**Setup:** No agents configured

**Steps:**
1. Click Agents tab

**Expected Results:**
- [ ] Empty state for agents
- [ ] "Add your first inspector" message
- [ ] "Add Agent" CTA button

### No Photos on Inspection
**Setup:** Inspection with no photos

**Steps:**
1. View inspection detail
2. Find Photos section

**Expected Results:**
- [ ] Empty gallery state
- [ ] "No photos added" message
- [ ] "Add Photos" button prominent

## Component Interaction Tests

### Filter by Status
**Setup:** Inspections in various statuses

**Steps:**
1. Click status filter
2. Select "Failed"
3. Observe results

**Expected Results:**
- [ ] Only failed inspections display
- [ ] Count updates in filter badge
- [ ] Clear filter option available

### Search Agents
**Setup:** 10 agents with different companies

**Steps:**
1. In Agents tab, type search term
2. Enter "QIMA"

**Expected Results:**
- [ ] Results filter as user types
- [ ] Matches on name, company, location
- [ ] Clear search returns all

### Date Range Filter
**Steps:**
1. Set date range: last 30 days
2. Observe filtered inspections

**Expected Results:**
- [ ] Only inspections within range display
- [ ] Uses scheduled date for filtering

## Edge Cases

### Inspection with Many Line Items
**Setup:** PO with 20 line items

**Steps:**
1. Schedule and start inspection
2. Record results for each line item

**Expected Results:**
- [ ] All line items accessible
- [ ] Individual pass/fail per item
- [ ] Overall result derives from all items
- [ ] Scrollable line items section

### Defect Severity Levels
**Setup:** Recording defects

**Steps:**
1. Add defect of each severity: minor, major, critical

**Expected Results:**
- [ ] Severity selection available
- [ ] Visual distinction by severity
- [ ] Critical defects highlighted
- [ ] Summary shows counts by severity

### Agent Hourly Rate Display
**Setup:** Agent with $65/hour rate

**Expected Results:**
- [ ] Rate displays formatted as currency
- [ ] Used for invoice estimation
- [ ] Editable in agent form

### Re-inspection History
**Setup:** Product inspected 3 times

**Steps:**
1. View inspection with history

**Expected Results:**
- [ ] Links to previous inspections
- [ ] Timeline shows inspection chain
- [ ] Defect rate trend visible

## Sample Test Data

```typescript
const sampleInspection: Inspection = {
  id: 'insp-001',
  purchaseOrderId: 'po-001',
  purchaseOrderNumber: 'PO-2024-0042',
  supplierName: 'Shenzhen Manufacturing',
  scheduledDate: '2024-02-15',
  completedDate: '2024-02-15',
  agentId: 'agent-001',
  agentName: 'Li Wei',
  status: 'passed',
  lineItems: [
    {
      id: 'ili-001',
      productName: 'Water Bottle 20oz Black',
      productSku: 'WB-20OZ-BLK',
      orderedQuantity: 1000,
      sampleSize: 200,
      defectsFound: 3,
      defectRate: 1.5,
      result: 'pass',
      defects: [
        {
          id: 'def-001',
          type: 'cosmetic',
          description: 'Minor scratch on lid',
          quantity: 2,
          severity: 'minor',
          photoIds: ['photo-001']
        },
        {
          id: 'def-002',
          type: 'labeling',
          description: 'Label slightly off-center',
          quantity: 1,
          severity: 'minor',
          photoIds: []
        }
      ],
      measurements: [
        {
          id: 'meas-001',
          name: 'Height',
          specValue: '250mm',
          actualValue: '249mm',
          passed: true
        }
      ],
      packaging: {
        boxCondition: 'good',
        labelingAccuracy: true,
        barcodeScans: true,
        notes: 'All barcodes scan correctly'
      },
      photos: []
    }
  ],
  result: 'pass',
  overallDefectRate: 1.5,
  totalSampleSize: 200,
  reworkRequest: null,
  notes: 'Good quality batch, minor cosmetic issues only'
}

const sampleAgent: InspectionAgent = {
  id: 'agent-001',
  name: 'Li Wei',
  email: 'liwei@qima.com',
  phone: '+86 755 8888 1234',
  company: 'QIMA',
  location: 'Shenzhen',
  hourlyRate: 45,
  specialties: ['Electronics', 'Packaging', 'Drinkware'],
  notes: 'Reliable inspector, 5+ years experience',
  isActive: true,
  paymentTermsTemplateId: 'template-upfront'
}

const sampleReworkRequest: ReworkRequest = {
  id: 'rework-001',
  createdDate: '2024-02-15',
  instructions: 'Replace damaged labels on 15 units. Re-seal packaging for units with torn shrink wrap.',
  supplierResponse: 'Will complete by Feb 20',
  completedDate: null,
  status: 'in-progress'
}
```
